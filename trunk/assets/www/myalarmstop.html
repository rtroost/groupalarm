<!DOCTYPE htlm>
<html>
	<head>
		<meta charset="UTF-8" />
		<style>
			body{
				margin: 0px;
				margin-top: 30%;
			}
			div{
				margin: auto auto;
				width: 40%;
			}
			button{
				width: 100%;
				height: 20%;
			}
		</style>
	</head>
	<body>

	<div>
		<h1></h1>
		<p>groepswekker: <span></span></p>
		<button id="stopalarm">
			STOPALARM
		</button>
		<button id="snoozealarm">
			SNOOZE
		</button>
	</div>


	<script src="js/jquery-min.js"></script>
	<script src="js/cordova-2.0.0.js"></script>
	<script src="js/ajax.js"></script>
	<script src="js/imei.js"></script>
	<script>
	
		var data = window.wekker.getData();
			console.log(data);
			var id = data.split('/')[0];
			var days = data.split('/')[1];
			var groep = data.split('/')[2];
			var snoozetime = data.split('/')[3];
			console.log('wekker id = ' + id);
			console.log('days = ' + days);
			console.log('groep = ' + groep);
			console.log('snoozetime = ' + snoozetime);
			
		$('h1').text('Wekker id = ' + id);
		if(groep == 'true'){
			$('span').text('ja');
		} else {
			$('span').text('nee');
		}
		
			
		$('button#stopalarm').on('click', function(){

			if(groep == 'true'){
				console.log('ajax!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!');
				window.ajax.add({
					url : 'http://www.remcovdk.com/groupalarm/groupalarm.php',
					type : 'POST',
					data : {
						action : 'deactivate',
						idevent : id,
						set : 1,
						imei : window.imei
					},
					dataType : 'json',
				}, function(msg) {
					
				}, function(msg) {
					console.log('kan geen verbinding maken');
				});
			} else {
				if(days == 'no-repeat'){
					window.ajax.add({
						url : 'http://www.remcovdk.com/groupalarm/alarm.php',
						type : 'POST',
						data : {
							action : 'active',
							set : 0,
							idwekker : id,
							imei : window.imei
						},
						dataType : 'json',
					}, function(msg) {
						
					}, function(msg) {
						console.log('kan geen verbinding maken');
					});
				
				} else {
					var repDays = days.split(',');
				}
			}
			
			window.wekker.stopAlarm();
			
		});
		
		$('button#snoozealarm').on('click', function(){
			
			if(groep == 'true'){ // update status
				console.log('ajax!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!');
				window.ajax.add({
					url : 'http://www.remcovdk.com/groupalarm/groupalarm.php',
					type : 'POST',
					data : {
						action : 'deactivate',
						set : 2,
						idevent : id,
						imei : window.imei
					},
					dataType : 'json',
				}, function(msg) {
					console.log(msg);
				}, function(msg) {
					console.log('kan geen verbinding maken');
				});
			}
			
			var d = new Date();
			var hour = parseInt(d.getHours());
			var min = parseInt(d.getMinutes());
			
			console.log('hour' + hour);
			console.log('min' + min);
			
			var newhour = parseInt(hour);
			var newmin = min+parseInt(snoozetime);
			console.log('newmin' + newmin);
			if(newmin > 60){
				var newhour = hour+1;
				newmin-=60;
				console.log('newmin' + newmin);
				if(newhour > 24){
					newhour-=24;
				}
			} 
			console.log('newhour' + newhour);
			console.log('newmin' + newmin);
			window.wekker.setAlarm(parseInt(id), newhour, newmin, groep, snoozetime);
			window.wekker.pauzeAlarm();
			
		});
		

		
		
	</script>
	
	</body>
</html>